<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Messenger Integration</title>
</head>
<body>
    <h1>Test Messenger Integration</h1>

    <!-- Include Facebook SDK -->
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v14.0&appId=924297842533211&autoLogAppEvents=1"></script>

    <!-- Messenger Plugin -->
    <div class="fb-customerchat" attribution="setup_tool" page_id="61569274589267"></div>

    <script>
        // Initialize Facebook SDK and force plugin rendering
        window.fbAsyncInit = function() {
            FB.init({
                appId: '924297842533211',  // Your Facebook App ID
                cookie: true,
                xfbml: true,  // Enable XFBML for the plugin to work
                version: 'v14.0'
            });
            console.log("Facebook SDK initialized");

            // Force the plugin to render
            FB.XFBML.parse();
        };
    </script>

    <!-- UTM Capture Script -->
    <script>
        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=None; Secure";
        }

        function getQueryParam(param) {
            var params = new URLSearchParams(window.location.search);
            return params.get(param);
        }

        function captureUTM() {
            const utmParams = ["utm_source", "utm_medium", "utm_campaign", "utm_term", "utm_content"];
            utmParams.forEach(param => {
                const value = getQueryParam(param);
                if (value) {
                    setCookie(param, value, 30);  // Store UTM values in cookies for 30 days
                    console.log(`${param} captured: `, value);
                }
            });
            console.log("Cookies after capture: ", document.cookie);
        }

        window.addEventListener("load", function() {
            captureUTM();
            setCookie("test_cookie", "working", 1);  // Set a test cookie
            console.log("Test cookie set: test_cookie=working");
        });
    </script>
</body>
</html>
